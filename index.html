<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="icon" href="favicon.png">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Number Problems</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #050505;
            --primary-hover: #2563eb;
            --primary-dark: #0f172a;
            --primary-light: #94a3b8;
            --text-color: #f8fafc;
            --text-muted: #94a3b8;
            --background-color: #0a0a0a;
            --card-bg: #141212;
            --card-border: #1e293b;
            --shadow: rgba(0, 0, 0, 0.4);
            --popup-bg: #1e293b;
            --header-bg: #0a0a0a;
            --header-color: #ffffff;
            --accent-glow: rgba(59, 130, 246, 0.2);
            --radius-lg: 16px;
            --radius-md: 12px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.5;
            min-height: 100vh;
            overflow-x: hidden;
        }

        #constellation-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1; 
            pointer-events: none;
        }

        .top-nav {
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding: 12px 0;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 101;
        }

        .top-nav a {
            color: white;
            text-decoration: none;
            margin: 0 20px;
            font-weight: 600;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s;
            opacity: 0.8;
            cursor: pointer;
        }

        .top-nav a:hover {
            opacity: 1;
            color: var(--primary-hover);
            text-shadow: 0 0 8px rgba(37, 99, 235, 0.5);
        }

        #custom-cursor {
            position: fixed;
            top: 0;
            left: 0;
            pointer-events: none;
            z-index: 999999;
            transition: transform 0.1s ease-out;
            transform-origin: top left;
        }

        #custom-cursor svg {
            width: 46px;
            height: 46px;
        }

        .cursor-path { fill: #ffffff; stroke: #000000; stroke-width: 3.0; }
        .cursor-hover { transform: scale(5.8); }

        header {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(12px);
            color: var(--header-color);
            padding: 0.75rem 1rem;
            position: sticky;
            top: 45px; 
            z-index: 100;
            border-bottom: 1px solid var(--card-border);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
            gap: 1.5rem;
        }

        .logo {
            font-size: 1.6rem;
            font-weight: 900;
            display: flex;
            align-items: center;
            gap: 10px;
            letter-spacing: -0.5px;
            cursor: pointer;
            text-shadow: 0 0 1px rgba(255,255,255,0.3);
        }

        .search-container {
            display: flex;
            gap: 8px;
            flex: 1;
            max-width: 700px;
        }

        #searchBar {
            padding: 0.75rem 1.25rem;
            border-radius: var(--radius-md);
            border: 1px solid var(--card-border);
            flex-grow: 1;
            font-size: 15px;
            background: rgba(255, 255, 255, 0.03);
            color: white;
            transition: all 0.2s;
        }

        #searchBar:focus { outline: none; background: rgba(255, 255, 255, 0.07); border-color: #3b82f6; }

        #sortOptions {
            padding: 0.85rem 1.2rem;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            background: #1e293b;
            color: white;
            cursor: pointer;
            font-weight: 500;
        }

        #settings {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 0.85rem 1.8rem;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            display: flex; align-items: center; gap: 8px;
            transition: 0.3s;
        }

        #settings:hover { background: rgba(255, 255, 255, 0.2); transform: translateY(-2px); }

        .stats-bar { padding: 0.75rem 1rem; background: rgba(15, 23, 42, 0.4); border-bottom: 1px solid var(--card-border); }
        .stats-content { max-width: 1400px; margin: 0 auto; font-size: 0.875rem; color: var(--text-muted); font-weight: 500; }

        main { max-width: 1400px; margin: 0 auto; padding: 1.5rem 1rem 4rem; }
        #container { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 1.25rem; }

        .zone-item {
            background-color: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: var(--radius-lg);
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            display: flex; flex-direction: column;
        }

        .zone-item:hover { transform: translateY(-4px); border-color: #3b82f6; box-shadow: 0 12px 24px -10px rgba(0,0,0,0.5); }
        .zone-item.featured { border: 1.5px solid #3b82f6; }
        .zone-item.featured::before {
            content: "FEATURED"; position: absolute; top: 8px; right: 8px; background: #3b82f6;
            color: white; padding: 2px 8px; border-radius: 6px; font-size: 0.65rem; font-weight: 800; z-index: 10;
        }

        .zone-item img { width: 100%; height: 160px; object-fit: cover; transition: 0.5s; filter: grayscale(10%); }
        .zone-item:hover img { transform: scale(1.08); }
        .zone-info { padding: 1rem; background: linear-gradient(to bottom, transparent, rgba(0,0,0,0.2)); }
        .zone-name { font-weight: 600; font-size: 0.95rem; text-align: center; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        #zoneViewer { position: fixed; inset: 0; background-color: #000; z-index: 10000; display: none; flex-direction: column; }
        .zone-header { display: flex; align-items: center; justify-content: space-between; background: #0f172a; padding: 0.75rem 1rem; border-bottom: 1px solid #1e293b; }
        .zone-controls { display: flex; gap: 8px; }
        .zone-controls button { background: #1e293b; border: 1px solid #334155; color: white; padding: 0.6rem 0.8rem; border-radius: 8px; cursor: pointer; transition: 0.2s; }
        .zone-controls button:hover { background: #3b82f6; }
        #zoneFrame { flex-grow: 1; border: none; background: #fff; }

        #popupOverlay { position: fixed; inset: 0; background-color: rgba(2, 6, 23, 0.85); display: none; align-items: center; justify-content: center; z-index: 2000; backdrop-filter: blur(8px); }
        .popup { background-color: var(--card-bg); border-radius: var(--radius-lg); width: 100%; max-width: 440px; border: 1px solid var(--card-border); overflow-y: auto; max-height: 90vh; }
        .popup-header { padding: 1.25rem; border-bottom: 1px solid var(--card-border); display: flex; justify-content: space-between; align-items: center; }
        
        .setting-item { margin-bottom: 1rem; }
        .setting-label { display: block; margin-bottom: 0.4rem; font-size: 0.8rem; color: #94a3b8; font-weight: 600; }
        .setting-input { width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #334155; background: #0f172a; color: white; }

        .loading { grid-column: 1 / -1; text-align: center; padding: 4rem; color: var(--text-muted); }
    </style>
</head>
<body>
    <canvas id="constellation-canvas"></canvas>

    <div id="custom-cursor">
        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M5.5 3.21V20.8c0 .45.54.67.85.35l4.83-4.83 2.46 5.92c.1.24.38.35.62.25l2.31-.96c.24-.1.35-.38.25-.62l-2.46-5.92h6.29c.31 0 .47-.38.25-.6L6.35 2.86a.494.494 0 0 0-.85.35Z" class="cursor-path" stroke-linecap="round" stroke-linejoin="round"></path>
        </svg>
    </div>

    <nav class="top-nav">
        <a onclick="location.reload()"><i class="fas fa-gamepad"></i> Games</a>
        <a onclick="openProxy()"><i class="fas fa-shield-alt"></i> Prοxy</a>
        <a href="#"><i class="fas fa-film"></i> Movies</a>
    </nav>

    <header>
        <div class="header-content">
            <div class="logo" onclick="location.reload()">
                <i class="fas fa-gamepad"></i>
                <span>Asphalt Games</span>
            </div>
            
            <div class="search-container">
                <input type="text" id="searchBar" placeholder="Search Games...">
                <select id="sortOptions">
                    <option value="popular">Popular</option>
                    <option value="name">Name</option>
                    <option value="id">ID</option>
                </select>
            </div>
            
            <button id="settings">
                <i class="fas fa-sliders-h"></i>
                <span>Settings</span>
            </button>
        </div>
    </header>

    <div class="stats-bar">
        <div class="stats-content">
            <span id="zoneCount">Discovering Library...</span>
        </div>
    </div>

    <main>
        <div id="container">
            <div class="loading">
                <i class="fas fa-circle-notch fa-spin fa-2x"></i>
                <p style="margin-top:1rem">Connecting to Server...</p>
            </div>
        </div>
    </main>

    <div id="zoneViewer">
        <div class="zone-header">
            <div class="zone-title">
                <h2 id="zoneName">Zone</h2>
                <span id="zoneId" style="display: none;"></span>
                <span id="zoneAuthor" style="font-size:0.75rem; color:var(--text-muted);"><i class="fas fa-circle-check"></i> Verified Creator</span>
            </div>
            <div class="zone-controls">
                <button onclick="fullscreenZone()" title="Fullscreen"><i class="fas fa-expand"></i></button>
                <button onclick="aboutBlank()" title="New Tab"><i class="fas fa-external-link-alt"></i></button>
                <button onclick="downloadZone()" title="Download"><i class="fas fa-download"></i></button>
                <button onclick="closeZone()" style="background: #7f1d1d; border-color:#b91c1c;"><i class="fas fa-times"></i> Close</button>
            </div>
        </div>
        <iframe id="zoneFrame"></iframe>
    </div>

    <div id="popupOverlay">
        <div class="popup">
            <div class="popup-header">
                <h3>Settings</h3>
                <button id="popupClose" style="background:none; border:none; color:white; font-size:1.5rem; cursor:pointer;">&times;</button>
            </div>
            <div id="popupBody" style="padding: 1.5rem;"></div>
        </div>
    </div>

    <script>
        const starCanvas = document.getElementById('constellation-canvas');
        const starCtx = starCanvas.getContext('2d');
        let points = [];
        const pointCount = 60;
        const maxDistance = 150;
        const speed = 0.2;

        function initStars() {
            starCanvas.width = window.innerWidth;
            starCanvas.height = window.innerHeight;
            points = [];
            for (let i = 0; i < pointCount; i++) {
                points.push({
                    x: Math.random() * starCanvas.width,
                    y: Math.random() * starCanvas.height,
                    vx: (Math.random() - 0.5) * speed,
                    vy: (Math.random() - 0.5) * speed,
                    radius: Math.random() * 1.5 + 0.5
                });
            }
        }

        function animateStars() {
            starCtx.clearRect(0, 0, starCanvas.width, starCanvas.height);
            points.forEach((p, i) => {
                p.x += p.vx; p.y += p.vy;
                if (p.x < 0 || p.x > starCanvas.width) p.vx *= -1;
                if (p.y < 0 || p.y > starCanvas.height) p.vy *= -1;
                starCtx.beginPath();
                starCtx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
                starCtx.fillStyle = "rgba(255, 255, 255, 0.8)";
                starCtx.fill();
                for (let j = i + 1; j < points.length; j++) {
                    const p2 = points[j];
                    const dx = p.x - p2.x; const dy = p.y - p2.y;
                    const dist = Math.sqrt(dx * dx + dy * dy);
                    if (dist < maxDistance) {
                        starCtx.beginPath();
                        starCtx.moveTo(p.x, p.y);
                        starCtx.lineTo(p2.x, p2.y);
                        starCtx.strokeStyle = `rgba(255, 255, 255, ${1 - dist / maxDistance - 0.2})`;
                        starCtx.lineWidth = 0.5;
                        starCtx.stroke();
                    }
                }
            });
            requestAnimationFrame(animateStars);
        }

        const cursor = document.getElementById('custom-cursor');
        document.addEventListener('mousemove', (e) => {
            cursor.style.transform = `translate(${e.clientX}px, ${e.clientY}px)`;
        });

        const container = document.getElementById('container');
        const searchBar = document.getElementById('searchBar');
        const sortOptions = document.getElementById('sortOptions');
        const zonesURL = "https://cdn.jsdelivr.net/gh/gn-math/assets@latest/zones.json";
        const coverURL = "https://cdn.jsdelivr.net/gh/gn-math/covers@main";
        const htmlURL = "https://cdn.jsdelivr.net/gh/gn-math/html@main";

        let config = {
            panicKey: localStorage.getItem('panicKey') || '1',
            panicUrl: localStorage.getItem('panicUrl') || 'https://google.com',
            cloakTitle: localStorage.getItem('cloakTitle') || 'Number Problems',
            cloakIcon: localStorage.getItem('cloakIcon') || 'favicon.png'
        };

        const customEntries = [
            { id: "000", name: "Asphalt Prοxy", author: "nikegtag", url: "https://ixlcdn.koyeb.app/", cover: "https://securly.pages.dev/favicon.png", featured: true, isExternal: true, forceTop: true }
        ];

        let zones = [];
        let popularityData = {};

        async function listZones() {
            try {
                const response = await fetch(zonesURL + "?t=" + Date.now());
                const json = await response.json();
                // Logic: Merge and filter out anything related to Discord
                zones = [...customEntries, ...json].filter(item => 
                    !item.name.toLowerCase().includes('discord') && 
                    !(item.url && item.url.toLowerCase().includes('discord'))
                );
                await fetchPopularity();
                sortZones();
                document.getElementById('zoneCount').textContent = `${zones.length} items available.`;
            } catch (error) {
                container.innerHTML = `<div class="loading"><p>Offline mode. Please check connection.</p></div>`;
            }
        }

        async function fetchPopularity() {
            try {
                const response = await fetch("https://data.jsdelivr.net/v1/stats/packages/gh/gn-math/html@main/files?period=year");
                const data = await response.json();
                data.forEach(file => {
                    const idMatch = file.name.match(/\/(\d+)\.html$/);
                    if (idMatch) popularityData[parseInt(idMatch[1])] = file.hits.total;
                });
            } catch (e) {}
        }

        function sortZones() {
            const sortBy = sortOptions.value;
            let list = [...zones];
            if (sortBy === 'name') list.sort((a, b) => a.name.localeCompare(b.name));
            else if (sortBy === 'id') list.sort((a, b) => a.id - b.id);
            else if (sortBy === 'popular') list.sort((a, b) => (popularityData[b.id] || 0) - (popularityData[a.id] || 0));
            list.sort((a, b) => (b.forceTop ? 1 : 0) - (a.forceTop ? 1 : 0));
            displayZones(list);
        }

        function displayZones(zonesToShow) {
            container.innerHTML = "";
            zonesToShow.forEach(file => {
                const zoneItem = document.createElement("div");
                zoneItem.className = "zone-item";
                if (file.featured) zoneItem.classList.add('featured');
                zoneItem.onclick = () => openZone(file);
                
                const img = document.createElement("img");
                img.loading = "lazy";
                img.src = file.isExternal ? file.cover : file.cover.replace("{COVER_URL}", coverURL);
                img.onerror = function() { this.src = 'https://via.placeholder.com/200x120?text=App'; };
                
                const zoneInfo = document.createElement("div");
                zoneInfo.className = "zone-info";
                const zoneName = document.createElement("div");
                zoneName.className = "zone-name";
                zoneName.textContent = file.name;
                
                zoneInfo.appendChild(zoneName);
                zoneItem.appendChild(img);
                zoneItem.appendChild(zoneInfo);
                container.appendChild(zoneItem);
            });
            updateCursorEvents();
        }

        function openZone(file) {
            const viewer = document.getElementById('zoneViewer');
            const frame = document.getElementById('zoneFrame');
            
            if (file.isExternal) {
                frame.src = file.url;
            } else {
                const url = file.url.replace("{HTML_URL}", htmlURL);
                fetch(url).then(r => r.text()).then(html => {
                    const doc = frame.contentDocument || frame.contentWindow.document;
                    doc.open(); doc.write(html); doc.close();
                });
            }

            document.getElementById('zoneName').textContent = file.name;
            document.getElementById('zoneId').textContent = file.id;
            document.getElementById('zoneAuthor').innerHTML = `<i class="fas fa-circle-check"></i> by ${file.author}`;
            viewer.style.display = "flex";
            document.body.style.overflow = 'hidden';
        }

        function openProxy() {
            const proxy = customEntries.find(z => z.id === "000");
            if(proxy) openZone(proxy);
        }

        function closeZone() {
            document.getElementById('zoneViewer').style.display = "none";
            document.getElementById('zoneFrame').src = "about:blank";
            document.body.style.overflow = 'auto';
        }

        function fullscreenZone() { document.getElementById('zoneFrame').requestFullscreen(); }

        function aboutBlank() {
            const win = window.open("about:blank", "_blank");
            const zoneId = document.getElementById('zoneId').textContent;
            const zone = zones.find(z => (z.id + '') === zoneId);
            if (zone) {
                if (zone.isExternal) win.location.href = zone.url;
                else {
                    fetch(zone.url.replace("{HTML_URL}", htmlURL)).then(r => r.text()).then(h => {
                        win.document.open(); win.document.write(h); win.document.close();
                    });
                }
            }
        }

        function downloadZone() {
            const zoneId = document.getElementById('zoneId').textContent;
            const zone = zones.find(z => (z.id + '') === zoneId);
            if (zone && !zone.isExternal) {
                fetch(zone.url.replace("{HTML_URL}", htmlURL)).then(r => r.text()).then(t => {
                    const blob = new Blob([t], {type: "text/html"});
                    const a = document.createElement('a'); a.href = URL.createObjectURL(blob);
                    a.download = zone.name + ".html"; a.click();
                });
            }
        }

        function openSettings() {
            document.getElementById('popupBody').innerHTML = `
                <div class="setting-item">
                    <label class="setting-label">Tab Title</label>
                    <input type="text" class="setting-input" value="${config.cloakTitle}" oninput="updateConfig('cloakTitle', this.value)">
                </div>
                <div class="setting-item">
                    <label class="setting-label">Favicon URL</label>
                    <input type="text" class="setting-input" value="${config.cloakIcon}" oninput="updateConfig('cloakIcon', this.value)">
                </div>
                <div class="setting-item">
                    <label class="setting-label">Panic Key (Keyboard)</label>
                    <input type="text" class="setting-input" maxlength="1" value="${config.panicKey}" oninput="updateConfig('panicKey', this.value)">
                </div>
                <div class="setting-item">
                    <label class="setting-label">Panic URL</label>
                    <input type="text" class="setting-input" value="${config.panicUrl}" oninput="updateConfig('panicUrl', this.value)">
                </div>
            `;
            document.getElementById('popupOverlay').style.display = "flex";
        }

        function updateConfig(key, val) {
            config[key] = val; localStorage.setItem(key, val);
            if (key === 'cloakTitle') document.title = val;
            if (key === 'cloakIcon') {
                const link = document.querySelector("link[rel*='icon']");
                if (link) link.href = val;
            }
        }

        function updateCursorEvents() {
            document.querySelectorAll('button, a, input, select, .zone-item').forEach(el => {
                el.onmouseenter = () => cursor.classList.add('cursor-hover');
                el.onmouseleave = () => cursor.classList.remove('cursor-hover');
            });
        }

        document.getElementById('settings').onclick = openSettings;
        document.getElementById('popupClose').onclick = () => document.getElementById('popupOverlay').style.display = "none";
        
        searchBar.addEventListener('input', (e) => {
            const q = e.target.value.toLowerCase();
            displayZones(zones.filter(z => z.name.toLowerCase().includes(q)));
        });

        sortOptions.addEventListener('change', sortZones);

        document.addEventListener('keydown', (e) => {
            if (e.key === config.panicKey) window.location.replace(config.panicUrl);
            if (e.key === 'Escape') closeZone();
        });

        window.addEventListener('resize', initStars);
        initStars();
        animateStars();
        listZones();
        
        document.title = config.cloakTitle;
        const link = document.querySelector("link[rel*='icon']");
        if (link) link.href = config.cloakIcon;
    </script>
</body>
</html>
